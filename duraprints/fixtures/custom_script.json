[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Order",
  "modified": "2021-04-19 15:56:08.642678",
  "name": "Sales Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Order Item', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\titem_code: function(frm,cdt,cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tif (frm.doc.default_wastage_type) {\n\t\t\trow.wastage_type = frm.doc.default_wastage_type;\n\t\t\trefresh_field(\"wastage_type\", cdn, \"items\");\n\t\t}\n\t\tif (frm.doc.default_wastage) {\n\t\t\trow.fabric_wastage = frm.doc.default_wastage;\n\t\t\trefresh_field(\"fabric_wastage\", cdn, \"items\");\n\t\t}\n\t\tif (frm.doc.master_rate) {\n\t\t\trow.rate = frm.doc.master_rate;\n\t\t\trefresh_field(\"rate\", cdn, \"items\");\n\t\t}\n\t},\n})\n\nfrappe.ui.form.on('Sales Order', {\n\tdefault_wastage_type: function(frm) {\n\t\t$.each(frm.doc.items || [], function(i, d) {\n\t\t\td.wastage_type = frm.doc.default_wastage_type;\n\t\t\t\n\t\t\tvar qty = 0;\n    \t\tif(frm.doc.default_wastage > 0){\n        \t\tif(frm.doc.default_wastage_type == 'Included'){\n        \t\t    qty = d.fabric_quantity * (1-(d.fabric_wastage/100));\n        \t\t}else{\n        \t\t    qty = d.fabric_quantity;\n        \t\t}\n    \t\t}else{\n    \t\t    qty = d.fabric_quantity;\n    \t\t}\n    \t\t\n    \t\td.qty = qty;\n\t\t});\n\t\trefresh_field(\"items\");\n\t},\n\tdefault_wastage: function(frm) {\n\t\t$.each(frm.doc.items || [], function(i, d) {\n\t\t\td.fabric_wastage = frm.doc.default_wastage;\n\t\t\t\n\t\t\tvar qty = 0;\n    \t\tif(frm.doc.default_wastage > 0){\n        \t\tif(frm.doc.default_wastage_type == 'Included'){\n        \t\t    qty = d.fabric_quantity * (1-(d.fabric_wastage/100));\n        \t\t}else{\n        \t\t    qty = d.fabric_quantity;\n        \t\t}\n    \t\t}else{\n    \t\t    qty = d.fabric_quantity;\n    \t\t}\n    \t\t\n    \t\td.qty = qty;\n\t\t\n\t\t});\n\t\trefresh_field(\"items\");\n\t},\n\tmaster_rate: function(frm) {\n\t\t$.each(frm.doc.items || [], function(i, d) {\n\t\t\td.rate = frm.doc.master_rate;\n\t\t});\n\t\trefresh_field(\"items\");\n\t},\n\tdefault_uom: function(frm) {\n\t\t$.each(frm.doc.items || [], function(i, d) {\n\t\t\td.uom = frm.doc.default_uom;\n\t\t});\n\t\trefresh_field(\"items\");\n\t},\n\tdelivery_date: function(frm){\n\t    $.each(frm.doc.items || [], function(i, d) {\n\t\t\td.delivery_date = frm.doc.delivery_date;\n\t\t});\n\t\trefresh_field(\"items\");\n\t}\n})\n\nvar fieldsArray = [\"fabric_quantity\",\"fabric_wastage\",\"wastage_type\"];\njQuery.each(fieldsArray, function(i, f){\n\tfrappe.ui.form.on('Sales Order Item', f, function(frm, cdt, cdn) {\n\t\t// your code here\n\t\tvar sales_order_item = frappe.model.get_doc(cdt, cdn);\n\t\t//console.log(f);\n\t\tvar fabric_quantity = sales_order_item.fabric_quantity;\n\t\tvar fabric_wastage = sales_order_item.fabric_wastage;\n\t\tvar wastage_type = sales_order_item.wastage_type;\n\t\tvar qty = 0;\n\t\tif(fabric_wastage > 0){\n    \t\tif(wastage_type == 'Included'){\n    \t\t    qty = fabric_quantity * (1-(fabric_wastage/100));\n    \t\t}else{\n    \t\t    qty = fabric_quantity;\n    \t\t}\n\t\t}\n\t\t\n\t\tfrappe.model.set_value(cdt, cdn, \"qty\", qty);\n\t\t\n\t\t\n\n\t});\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Item",
  "modified": "2020-12-31 11:45:58.772272",
  "name": "Item-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item', {\n\tbefore_save: function(frm,cdt,cdn) {\n\t\t//console.log(frm.doc);\n\t\tvar fabric_source = \"\";\n\t\tvar fabric_type = \"\";\n\t\tvar fabric_gsm, fabric_width = \"\";\n\t\tvar fabric_material = frm.doc.item_group.split(\" \");\n\t\tvar item_group = frm.doc.item_group;\n\t\tif(item_group == 'Cotton fabrics' || item_group == 'Polyester fabrics' || item_group == 'Silk fabrics' || item_group == 'Viscose fabrics'){\n\t\t    for(var i=0; i<frm.doc.attributes.length; i++){\n    \t\t    switch(frm.doc.attributes[i].attribute){\n    \t\t        case 'Source':\n    \t\t            fabric_source = frm.doc.attributes[i].attribute_value;\n    \t\t        case 'Type':\n    \t\t            fabric_type = frm.doc.attributes[i].attribute_value;\n    \t            case 'GSM':\n    \t\t            fabric_gsm = frm.doc.attributes[i].attribute_value;\n    \t\t        case 'Width':\n    \t\t            fabric_width = frm.doc.attributes[i].attribute_value;\n    \t\t    }\n    \t\t    \n    \t\t}\n    \t\tif(frm.doc.variant_of != \"\"){\n    \t\t    frappe.model.set_value(cdt, cdn, \"fabric_source\", fabric_source);\n    \t\t    frappe.model.set_value(cdt, cdn, \"fabric_type\", fabric_type); \n    \t\t    frappe.model.set_value(cdt, cdn, \"fabric_gsm\", fabric_gsm); \n    \t\t    frappe.model.set_value(cdt, cdn, \"fabric_width\", fabric_width);\n    \t\t    frappe.model.set_value(cdt, cdn, \"fabric_material\", fabric_material[0]);\n    \t\t    console.log(frm.doc.attributes);\n    \t\t} \n\t\t}\n\t\t\n\t\t\n\t}\n})"
 }
]